<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_saleorder_document_inherit" inherit_id="sale.report_saleorder_document">
        <xpath expr="//th[@name='th_quantity']" position="replace"/>
        <xpath expr="//td[@name='td_quantity']" position="replace"/>
        <xpath expr="//th[@name='th_subtotal']" position="replace"/>
        <xpath expr="//td[@name='td_subtotal']" position="replace"/>
        <xpath expr="//td[@name='td_priceunit']" position="replace">
            <t t-set="priceunit" t-value="line.price_total- line.management_price"/>
                <td name="td_priceunit" class="text-right">
                    <span t-esc="priceunit"/>
                </td>
        </xpath>
        <xpath expr="//t[@t-foreach='doc.order_line']" position="before">
            <t t-set="management_fees" t-value="0"/>
        </xpath>
       <xpath expr="//t[@t-foreach='doc.order_line']/tr" position="before">
            <t t-set="management_fees" t-value="management_fees + line.management_price"/>
       </xpath>
       <xpath expr="//t[@t-foreach='doc.order_line']" position="after">
            <t t-set="priceunit" t-value="0"/>
            <tr>
                <td>Management Fees</td>
                <td colspan="2" class="text-righ"><span t-esc="management_fees"/></td>
            </tr>
        </xpath>
    </template>
</odoo>
